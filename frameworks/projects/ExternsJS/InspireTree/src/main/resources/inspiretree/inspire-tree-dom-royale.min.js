/**
 *  Licensed to the Apache Software Foundation (ASF) under one or more
 *  contributor license agreements.  See the NOTICE file distributed with
 *  this work for additional information regarding copyright ownership.
 *  The ASF licenses this file to You under the Apache License, Version 2.0
 *  (the "License"); you may not use this file except in compliance with
 *  the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
 !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash"),require("inspire-tree")):"function"==typeof define&&define.amd?define(["lodash","inspire-tree"],t):e.InspireTreeDOM=t(e._,e.InspireTree)}(this,function(e,t){"use strict";function n(e){var t=typeof e;return"string"===t||"number"===t}function o(e){return c(e)||l(e)}function r(e){return l(e)||e===!1||d(e)||c(e)}function i(e){return"function"==typeof e}function a(e){return"string"==typeof e}function s(e){return"number"==typeof e}function l(e){return null===e}function d(e){return e===!0}function c(e){return void 0===e}function u(e){throw e||(e=Be),new Error("Inferno Error: "+e)}function p(e,t){var n={};if(e)for(var o in e)n[o]=e[o];if(t)for(var r in t)n[r]=t[r];return n}function f(e,t,n,o,r,i,a,s){return{childFlags:e,children:t,className:n,dom:null,flags:o,key:void 0===r?null:r,parentVNode:null,props:void 0===i?null:i,ref:void 0===a?null:a,type:s}}function h(e,t,n,o,r,i,a,s){var l=void 0===r?1:r,d=f(l,o,n,e,a,i,s,t);return 0===l&&$(d,d.children),d}function v(e,t,n,r,a){(2&e)>0&&(e=t.prototype&&i(t.prototype.render)?4:8);var s=t.defaultProps;if(!o(s)){n||(n={});for(var l in s)c(n[l])&&(n[l]=s[l])}if((8&e)>0){var d=t.defaultHooks;if(!o(d))if(a)for(var u in d)c(a[u])&&(a[u]=d[u]);else a=d}var p=f(1,null,null,e,r,n,a,t),h=Ke.createVNode;return i(h)&&h(p),p}function g(e,t){return f(1,o(e)?"":e,null,16,t,null,null,null)}function m(e){var t=e.props;if(t){var n=e.flags;481&n&&(void 0!==t.children&&o(e.children)&&$(e,t.children),void 0!==t.className&&(e.className=t.className||null,t.className=void 0)),void 0!==t.key&&(e.key=t.key,t.key=void 0),void 0!==t.ref&&(8&n?e.ref=p(e.ref,t.ref):e.ref=t.ref,t.ref=void 0)}return e}function y(e){var t,n=e.flags;if(14&n){var o,r=e.props;if(!l(r)){o={};for(var i in r)o[i]=r[i]}t=v(n,e.type,o,e.key,e.ref)}else 481&n?t=h(n,e.type,e.className,e.children,e.childFlags,e.props,e.key,e.ref):16&n?t=g(e.children,e.key):1024&n&&(t=e);return t}function b(){return g("",null)}function k(e,t,o,i){for(var s=e.length;s>o;o++){var d=e[o];if(!r(d)){var c=i+qe+o;if(He(d))k(d,t,0,c);else{if(n(d))d=g(d,c);else{var u=d.key,p=a(u)&&u[0]===qe;(!l(d.dom)||p)&&(d=y(d)),l(u)||p?d.key=c:d.key=i+u}t.push(d)}}}}function $(e,t){var o,i=1;if(r(t))o=t;else if(a(t))i=2,o=g(t);else if(s(t))i=2,o=g(t+"");else if(He(t)){var d=t.length;if(0===d)o=null,i=1;else{(Object.isFrozen(t)||t.$===!0)&&(t=t.slice()),i=8;for(var c=0;d>c;c++){var u=t[c];if(r(u)||He(u)){o=o||t.slice(0,c),k(t,o,c,"");break}if(n(u))o=o||t.slice(0,c),o.push(g(u,qe+c));else{var p=u.key,f=l(u.dom),h=l(p),v=!h&&p[0]===qe;!f||h||v?(o=o||t.slice(0,c),(!f||v)&&(u=y(u)),(h||v)&&(u.key=qe+c),o.push(u)):o&&o.push(u)}}o=o||t,o.$=!0}}else o=t,l(t.dom)||(o=y(t)),i=2;return e.children=o,e.childFlags=i,e}function C(e,t){e.appendChild(t)}function D(e,t,n){o(n)?C(e,t):e.insertBefore(t,n)}function _(e,t){return t===!0?document.createElementNS(Qe,e):document.createElement(e)}function x(e,t,n){e.replaceChild(t,n)}function S(e,t){e.removeChild(t)}function w(e){for(var t;void 0!==(t=e.shift());)t()}function N(e,t,n){var o=Ze[e],r=n.$EV;t?(o||(et[e]=T(e),Ze[e]=0),r||(r=n.$EV={}),r[e]||Ze[e]++,r[e]=t):r&&r[e]&&(Ze[e]--,1===o&&(document.removeEventListener(O(e),et[e]),et[e]=null),r[e]=t)}function P(e,t,n,o,r){for(var i=t;!l(i);){if(n&&i.disabled)return;var a=i.$EV;if(a){var s=a[o];if(s&&(r.dom=i,s.event?s.event(s.data,e):s(e),e.cancelBubble))return}i=i.parentNode}}function O(e){return e.substr(2).toLowerCase()}function L(){this.cancelBubble=!0,this.immediatePropagationStopped||this.stopImmediatePropagation()}function T(e){var t=function(t){var n=t.type,o="click"===n||"dblclick"===n;if(o&&0!==t.button)return t.stopPropagation(),!1;t.stopPropagation=L;var r={dom:document};Object.defineProperty(t,"currentTarget",{configurable:!0,get:function(){return r.dom}}),P(t,t.target,o,e,r)};return document.addEventListener(O(e),t),t}function U(e,t){var n=document.createElement("i");return n.innerHTML=t,n.innerHTML===e.innerHTML}function M(e,t){return Boolean(t&&t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html&&U(e,t.dangerouslySetInnerHTML.__html))}function E(e,t,n){if(e[t]){var o=e[t];o.event?o.event(o.data,n):o(n)}else{var r=t.toLowerCase();e[r]&&e[r](n)}}function F(e,t){var n=function(n){n.stopPropagation();var o=this.$V;if(o){var r=o.props||Ye,s=o.dom;if(a(e))E(r,e,n);else for(var l=0;l<e.length;l++)E(r,e[l],n);if(i(t)){var d=this.$V,c=d.props||Ye;t(c,s,!1,d)}}};return Object.defineProperty(n,"wrapped",{configurable:!1,enumerable:!1,value:!0,writable:!1}),n}function A(e){return"checkbox"===e||"radio"===e}function I(e){e.stopPropagation()}function V(e,t){A(t.type)?(e.onchange=nt,e.onclick=I):e.oninput=tt}function R(e,t){var n=e.type,r=e.value,i=e.checked,a=e.multiple,s=e.defaultValue,l=!o(r);n&&n!==t.type&&t.setAttribute("type",n),o(a)||a===t.multiple||(t.multiple=a),o(s)||l||(t.defaultValue=s+""),A(n)?(l&&(t.value=r),o(i)||(t.checked=i)):l&&t.value!==r?(t.defaultValue=r,t.value=r):o(i)||(t.checked=i)}function j(e,t){var n=e.type;if("optgroup"===n){var o=e.children,r=e.childFlags;if(12&r)for(var i=0,a=o.length;a>i;i++)B(o[i],t);else 2===r&&B(o,t)}else B(e,t)}function B(e,t){var n=e.props||Ye,r=e.dom;r.value=n.value,He(t)&&-1!==t.indexOf(n.value)||n.value===t?r.selected=!0:o(t)&&o(n.selected)||(r.selected=n.selected||!1)}function W(e){e.onchange=ot}function H(e,t,n,r){var i=Boolean(e.multiple);o(e.multiple)||i===t.multiple||(t.multiple=i);var a=r.childFlags;if(0===(1&a)){var s=r.children,l=e.value;if(n&&o(l)&&(l=e.defaultValue),12&a)for(var d=0,c=s.length;c>d;d++)j(s[d],l);else 2===a&&j(s,l)}}function q(e,t){e.oninput=rt,t.onChange&&(e.onchange=it)}function K(e,t,n){var r=e.value,i=t.value;if(o(r)){if(n){var a=e.defaultValue;o(a)||a===i||(t.defaultValue=a,t.value=a)}}else i!==r&&(t.defaultValue=r,t.value=r)}function X(e,t,n,o,r,i){64&e?R(o,n):256&e?H(o,n,r,t):128&e&&K(o,n,r),i&&(n.$V=t)}function z(e,t,n){64&e?V(t,n):256&e?W(t):128&e&&q(t,n)}function Q(e){return e.type&&A(e.type)?!o(e.checked):!o(e.value)}function G(e,t){Y(e),t&&e.dom&&(S(t,e.dom),e.dom=null)}function Y(e){var t=e.flags;if(481&t){var n=e.ref,r=e.props;i(n)&&n(null);var a=e.children,s=e.childFlags;if(12&s?J(a):2===s&&Y(a),!l(r))for(var d in r)switch(d){case"onClick":case"onDblClick":case"onFocusIn":case"onFocusOut":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onMouseDown":case"onMouseMove":case"onMouseUp":case"onSubmit":case"onTouchEnd":case"onTouchMove":case"onTouchStart":N(d,null,e.dom)}}else{var c=e.children;if(c)if(14&t){var u=e.ref;4&t?(i(c.componentWillUnmount)&&c.componentWillUnmount(),i(u)&&u(null),c.$UN=!0,c.$LI&&Y(c.$LI)):(!o(u)&&i(u.onComponentWillUnmount)&&u.onComponentWillUnmount(e.dom,e.props||Ye),Y(c))}else 1024&t&&G(c,e.type)}}function J(e){for(var t=0,n=e.length;n>t;t++)Y(e[t])}function Z(e,t){J(t),e.textContent=""}function ee(e,t){return function(n){e(t.data,n)}}function te(e,t,n,r){var a=e.toLowerCase();if(i(n)||o(n)){var s=r[a];s&&s.wrapped||(r[a]=n)}else{var l=n.event;l&&i(l)&&(r[a]=ee(l,n))}}function ne(e,t){switch(e){case"animationIterationCount":case"borderImageOutset":case"borderImageSlice":case"borderImageWidth":case"boxFlex":case"boxFlexGroup":case"boxOrdinalGroup":case"columnCount":case"fillOpacity":case"flex":case"flexGrow":case"flexNegative":case"flexOrder":case"flexPositive":case"flexShrink":case"floodOpacity":case"fontWeight":case"gridColumn":case"gridRow":case"lineClamp":case"lineHeight":case"opacity":case"order":case"orphans":case"stopOpacity":case"strokeDasharray":case"strokeDashoffset":case"strokeMiterlimit":case"strokeOpacity":case"strokeWidth":case"tabSize":case"widows":case"zIndex":case"zoom":return t;default:return t+"px"}}function oe(e,t,n){var r,i,l=n.style;if(a(t))return void(l.cssText=t);if(o(e)||a(e))for(r in t)i=t[r],l[r]=s(i)?ne(r,i):i;else{for(r in t)i=t[r],i!==e[r]&&(l[r]=s(i)?ne(r,i):i);for(r in e)o(t[r])&&(l[r]="")}}function re(e,t,n,r,i,a,s){switch(e){case"onClick":case"onDblClick":case"onFocusIn":case"onFocusOut":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onMouseDown":case"onMouseMove":case"onMouseUp":case"onSubmit":case"onTouchEnd":case"onTouchMove":case"onTouchStart":N(e,n,r);break;case"children":case"childrenType":case"className":case"defaultValue":case"key":case"multiple":case"ref":break;case"autoFocus":r.autofocus=!!n;break;case"allowfullscreen":case"autoplay":case"capture":case"checked":case"controls":case"default":case"disabled":case"hidden":case"indeterminate":case"loop":case"muted":case"novalidate":case"open":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"selected":r[e]=!!n;break;case"defaultChecked":case"value":case"volume":if(a&&"value"===e)return;var d=o(n)?"":n;r[e]!==d&&(r[e]=d);break;case"dangerouslySetInnerHTML":var c=t&&t.__html||"",u=n&&n.__html||"";c!==u&&(o(u)||U(r,u)||(l(s)||(12&s.childFlags?J(s.children):2===s.childFlags&&Y(s.children),s.children=null,s.childFlags=1),r.innerHTML=u));break;default:"o"===e[0]&&"n"===e[1]?te(e,t,n,r):o(n)?r.removeAttribute(e):"style"===e?oe(t,n,r):i&&Ge[e]?r.setAttributeNS(Ge[e],e,n):r.setAttribute(e,n)}}function ie(e,t,n,o,r){var i=!1,a=(448&t)>0;a&&(i=Q(n),i&&z(t,o,n));for(var s in n)re(s,null,n[s],o,r,i,null);a&&X(t,e,o,n,!0,i)}function ae(e,t,n,r){var a=new t(n,r);if(e.children=a,a.$V=e,a.$BS=!1,a.context=r,a.props===Ye&&(a.props=n),a.$UN=!1,i(a.componentWillMount)){if(a.$BR=!0,a.componentWillMount(),a.$PSS){var s=a.state,d=a.$PS;if(l(s))a.state=d;else for(var c in d)s[c]=d[c];a.$PSS=!1,a.$PS=null}a.$BR=!1}i(Ke.beforeRender)&&Ke.beforeRender(a);var u,f=se(a.render(n,a.state,r),e);return i(a.getChildContext)&&(u=a.getChildContext()),o(u)?a.$CX=r:a.$CX=p(r,u),i(Ke.afterRender)&&Ke.afterRender(a),a.$LI=f,a}function se(e,t){return r(e)?e=b():n(e)?e=g(e,null):(e.dom&&(e=y(e)),14&e.flags&&(e.parentVNode=t)),e}function le(e,t,n,o){var r=e.flags;return 481&r?ce(e,t,n,o):14&r?pe(e,t,n,o,(4&r)>0):512&r||16&r?de(e,t):1024&r?(le(e.children,e.type,n,!1),e.dom=de(b(),t)):void 0}function de(e,t){var n=e.dom=document.createTextNode(e.children);return l(t)||C(t,n),n}function ce(e,t,n,r){var a=e.flags,s=e.children,d=e.props,c=e.className,u=e.ref,p=e.childFlags;r=r||(32&a)>0;var f=_(e.type,r);if(e.dom=f,o(c)||""===c||(r?f.setAttribute("class",c):f.className=c),l(t)||C(t,f),0===(1&p)){var h=r===!0&&"foreignObject"!==e.type;2===p?le(s,f,n,h):12&p&&ue(s,f,n,h)}return l(d)||ie(e,a,d,f,r),i(u)&&me(f,u),f}function ue(e,t,n,o){for(var r=0,i=e.length;i>r;r++){var a=e[r];l(a.dom)||(e[r]=a=y(a)),le(a,t,n,o)}}function pe(e,t,n,o,r){var i,a=e.type,s=e.props||Ye,d=e.ref;if(r){var c=ae(e,a,s,n);e.dom=i=le(c.$LI,null,c.$CX,o),he(e,d,c),c.$UPD=!1}else{var u=se(a(s,n),e);e.children=u,e.dom=i=le(u,null,n,o),ge(s,d,i)}return l(t)||C(t,i),i}function fe(e){return function(){e.componentDidMount()}}function he(e,t,n){i(t)&&t(n),i(n.componentDidMount)&&Je.push(fe(n))}function ve(e,t,n){return function(){return e.onComponentDidMount(t,n)}}function ge(e,t,n){o(t)||(i(t.onComponentWillMount)&&t.onComponentWillMount(e),i(t.onComponentDidMount)&&Je.push(ve(t,n,e)))}function me(e,t){Je.push(function(){return t(e)})}function ye(e,t,n,o,r){var i=e.type,a=e.ref,s=e.props||Ye;if(r){var l=ae(e,i,s,n),d=l.$LI;$e(d,t,l.$CX,o),e.dom=d.dom,he(e,a,l),l.$UPD=!1}else{var c=se(i(s,n),e);$e(c,t,n,o),e.children=c,e.dom=c.dom,ge(s,a,t)}}function be(e,t,n,r){var a=e.children,s=e.props,d=e.className,c=e.flags,u=e.ref;if(r=r||(32&c)>0,1!==t.nodeType||t.tagName.toLowerCase()!==e.type){var p=ce(e,null,n,r);e.dom=p,x(t.parentNode,p,t)}else{e.dom=t;var f=t.firstChild,h=e.childFlags;if(0===(1&h)){for(var v=null;f;)v=f.nextSibling,8===f.nodeType&&("!"===f.data?t.replaceChild(document.createTextNode(""),f):t.removeChild(f)),f=v;if(f=t.firstChild,2===h)l(f)?le(a,t,n,r):(v=f.nextSibling,$e(a,f,n,r),f=v);else if(12&h)for(var g=0,m=a.length;m>g;g++){var y=a[g];l(f)?le(y,t,n,r):(v=f.nextSibling,$e(y,f,n,r),f=v)}for(;f;)v=f.nextSibling,t.removeChild(f),f=v}else l(t.firstChild)||M(t,s)||(t.textContent="",448&c&&(t.defaultValue=""));l(s)||ie(e,c,s,t,r),o(d)?""!==t.className&&t.removeAttribute("class"):r?t.setAttribute("class",d):t.className=d,i(u)&&me(t,u)}}function ke(e,t){if(3!==t.nodeType){var n=de(e,null);e.dom=n,x(t.parentNode,n,t)}else{var o=e.children;t.nodeValue!==o&&(t.nodeValue=o),e.dom=t}}function $e(e,t,n,o){var r=e.flags;14&r?ye(e,t,n,o,(4&r)>0):481&r?be(e,t,n,o):16&r?ke(e,t):512&r?e.dom=t:u()}function Ce(e,t,n){var o=t.firstChild;if(!l(o))for(r(e)||$e(e,o,Ye,!1),o=t.firstChild;o=o.nextSibling;)t.removeChild(o);Je.length>0&&w(Je),t.$V=e,i(n)&&n()}function De(e,t,n,o,r){Y(e),x(n,le(t,null,o,r),e.dom)}function _e(e,t,n,o,r){if(e!==t){var i=0|t.flags;e.flags!==i||2048&i?De(e,t,n,o,r):481&i?Se(e,t,n,o,r):14&i?Pe(e,t,n,o,r,(4&i)>0):16&i?Oe(e,t,n):512&i?t.dom=e.dom:xe(e,t,o)}}function xe(e,t,n){var o=e.type,i=t.type,a=t.children;if(we(e.childFlags,t.childFlags,e.children,a,o,n,!1),t.dom=e.dom,o!==i&&!r(a)){var s=a.dom;o.removeChild(s),i.appendChild(s)}}function Se(e,t,n,r,a){var s=t.type;if(e.type!==s)De(e,t,n,r,a);else{var l,d=e.dom,c=t.flags,u=e.props,p=t.props,f=!1,h=!1;if(t.dom=d,a=a||(32&c)>0,u!==p){var v=u||Ye;if(l=p||Ye,l!==Ye){f=(448&c)>0,f&&(h=Q(l));for(var g in l){var m=v[g],y=l[g];m!==y&&re(g,m,y,d,a,h,e)}}if(v!==Ye)for(var b in v)l.hasOwnProperty(b)||o(v[b])||re(b,v[b],null,d,a,h,e)}var k=e.children,$=t.children,C=t.ref,D=e.className,_=t.className;k!==$&&we(e.childFlags,t.childFlags,k,$,d,r,a&&"foreignObject"!==s),f&&X(c,t,d,l,!1,h),D!==_&&(o(_)?d.removeAttribute("class"):a?d.setAttribute("class",_):d.className=_),i(C)&&e.ref!==C&&me(d,C)}}function we(e,t,n,o,r,i,a){switch(e){case 2:switch(t){case 2:_e(n,o,r,i,a);break;case 1:G(n,r);break;default:G(n,r),ue(o,r,i,a)}break;case 1:switch(t){case 2:le(o,r,i,a);break;case 1:break;default:ue(o,r,i,a)}break;default:if(12&t){var s=n.length,l=o.length;0===s?l>0&&ue(o,r,i,a):0===l?Z(r,n):8===t&&8===e?Te(n,o,r,i,a,s,l):Le(n,o,r,i,a,s,l)}else 1===t?Z(r,n):(Z(r,n),le(o,r,i,a))}}function Ne(e,t,n,r,a,s,l,d,c){var u=e.state,f=e.props;n.children=e;var h;if(!e.$UN){if(f!==r||r===Ye){if(!c&&i(e.componentWillReceiveProps)){if(e.$BR=!0,e.componentWillReceiveProps(r,s),e.$UN)return;e.$BR=!1}e.$PSS&&(t=p(t,e.$PS),e.$PSS=!1,e.$PS=null)}var v=Boolean(e.shouldComponentUpdate);if(d||!v||v&&e.shouldComponentUpdate(r,t,s)){i(e.componentWillUpdate)&&(e.$BS=!0,e.componentWillUpdate(r,t,s),e.$BS=!1),e.props=r,e.state=t,e.context=s,i(Ke.beforeRender)&&Ke.beforeRender(e),h=e.render(r,t,s),i(Ke.afterRender)&&Ke.afterRender(e);var g,m=h!==je;if(i(e.getChildContext)&&(g=e.getChildContext()),g=o(g)?s:p(s,g),e.$CX=g,m){var y=e.$LI,b=e.$LI=se(h,n);_e(y,b,a,g,l),i(e.componentDidUpdate)&&e.componentDidUpdate(f,u)}}else e.props=r,e.state=t,e.context=s;n.dom=e.$LI.dom}}function Pe(e,t,n,r,a,s){var l=t.type,d=e.key,c=t.key;if(e.type!==l||d!==c)De(e,t,n,r,a);else{var u=t.props||Ye;if(s){var p=e.children;p.$UPD=!0,p.$V=t,Ne(p,p.state,t,u,n,r,a,!1,!1),p.$UPD=!1}else{var f=!0,h=e.props,v=t.ref,g=!o(v),m=e.children;if(t.dom=e.dom,t.children=m,g&&i(v.onComponentShouldUpdate)&&(f=v.onComponentShouldUpdate(h,u)),f!==!1){g&&i(v.onComponentWillUpdate)&&v.onComponentWillUpdate(h,u);var y=l(u,r);y!==je&&(y=se(y,t),_e(m,y,n,r,a),t.children=y,t.dom=y.dom,g&&i(v.onComponentDidUpdate)&&v.onComponentDidUpdate(h,u))}else 14&m.flags&&(m.parentVNode=t)}}}function Oe(e,t,n){var o,r=t.children,i=n.firstChild;l(i)?(n.textContent=r,o=n.firstChild):(o=e.dom,r!==e.children&&(o.nodeValue=r)),t.dom=o}function Le(e,t,n,o,r,i,a){for(var s,l,d=i>a?a:i,c=0;d>c;c++)s=t[c],l=e[c],s.dom&&(s=t[c]=y(s)),_e(l,s,n,o,r),e[c]=s;if(a>i)for(c=d;a>c;c++)s=t[c],s.dom&&(s=t[c]=y(s)),le(s,n,o,r);else if(i>a)for(c=d;i>c;c++)G(e[c],n)}function Te(e,t,n,o,r,i,a){var s,l,d=i-1,c=a-1,u=0,p=e[u],f=t[u];e:{for(;p.key===f.key;){if(f.dom&&(t[u]=f=y(f)),_e(p,f,n,o,r),e[u]=f,u++,u>d||u>c)break e;p=e[u],f=t[u]}for(p=e[d],f=t[c];p.key===f.key;){if(f.dom&&(t[c]=f=y(f)),_e(p,f,n,o,r),e[d]=f,d--,c--,u>d||u>c)break e;p=e[d],f=t[c]}}if(u>d){if(c>=u){l=c+1;for(var h=a>l?t[l].dom:null;c>=u;)f=t[u],f.dom&&(t[u]=f=y(f)),u++,D(n,le(f,null,o,r),h)}}else if(u>c)for(;d>=u;)G(e[u++],n);else{var v=u,g=u,m=d-u+1,b=c-u+1,k=[];for(s=0;b>s;s++)k.push(0);var $=m===i,C=!1,_=0,x=0;if(4>a||32>(m|b))for(s=v;d>=s;s++)if(p=e[s],b>x){for(u=g;c>=u;u++)if(f=t[u],p.key===f.key){if(k[u-g]=s+1,$)for($=!1;s>v;)G(e[v++],n);_>u?C=!0:_=u,f.dom&&(t[u]=f=y(f)),_e(p,f,n,o,r),x++;break}!$&&u>c&&G(p,n)}else $||G(p,n);else{var S={};for(s=g;c>=s;s++)S[t[s].key]=s;for(s=v;d>=s;s++)if(p=e[s],b>x)if(u=S[p.key],void 0!==u){if($)for($=!1;s>v;)G(e[v++],n);f=t[u],k[u-g]=s+1,_>u?C=!0:_=u,f.dom&&(t[u]=f=y(f)),_e(p,f,n,o,r),x++}else $||G(p,n);else $||G(p,n)}if($)Z(n,e),ue(t,n,o,r);else if(C){var w=Ue(k);for(u=w.length-1,s=b-1;s>=0;s--)0===k[s]?(_=s+g,f=t[_],f.dom&&(t[_]=f=y(f)),l=_+1,D(n,le(f,null,o,r),a>l?t[l].dom:null)):0>u||s!==w[u]?(_=s+g,f=t[_],l=_+1,D(n,f.dom,a>l?t[l].dom:null)):u--}else if(x!==b)for(s=b-1;s>=0;s--)0===k[s]&&(_=s+g,f=t[_],f.dom&&(t[_]=f=y(f)),l=_+1,D(n,le(f,null,o,r),a>l?t[l].dom:null))}}function Ue(e){var t,n,o,r,i,a=e.slice(),s=[0],l=e.length;for(t=0;l>t;t++){var d=e[t];if(0!==d){if(n=s[s.length-1],e[n]<d){a[t]=n,s.push(t);continue}for(o=0,r=s.length-1;r>o;)i=(o+r)/2|0,e[s[i]]<d?o=i+1:r=i;d<e[s[o]]&&(o>0&&(a[t]=s[o-1]),s[o]=t)}}for(o=s.length,r=s[o-1];o-->0;)s[o]=r,r=a[r];return s}function Me(e,t,n){if(e!==je){var a=t.$V;return o(a)?r(e)||(e.dom&&(e=y(e)),l(t.firstChild)?(le(e,t,Ye,!1),t.$V=e):Ce(e,t),a=e):o(e)?(G(a,t),t.$V=null):(e.dom&&(e=y(e)),_e(a,e,t,Ye,!1),a=t.$V=e),Je.length>0&&w(Je),i(n)&&n(),i(Ke.renderComplete)&&Ke.renderComplete(a),a&&14&a.flags?a.children:void 0}}function Ee(e){return at?at.then(e):st(e)}function Fe(e,t,n,r){i(t)&&(t=t(e.state,e.props,e.context));var a=e.$PS;if(o(a))e.$PS=t;else for(var s in t)a[s]=t[s];if(e.$PSS||e.$BR)e.$PSS=!0,e.$BR&&i(n)&&Je.push(n.bind(e));else if(e.$UPD){var d=e.$QU;l(d)&&(d=e.$QU=[],Ee(Ae(e,d))),i(n)&&d.push(n)}else e.$PSS=!0,e.$UPD=!0,Ie(e,r,n),e.$UPD=!1}function Ae(e,t){return function(){e.$QU=null,e.$UPD=!0,Ie(e,!1,function(){for(var n=0,o=t.length;o>n;n++)t[n].call(e)}),e.$UPD=!1}}function Ie(e,t,n){if(!e.$UN){if(t||!e.$BR){e.$PSS=!1;var o=e.$PS,r=e.state,a=p(r,o),s=e.props,d=e.context;e.$PS=null;var c=e.$V,u=e.$LI,f=u.dom&&u.dom.parentNode;if(Ne(e,a,c,s,f,d,(32&c.flags)>0,t,!0),e.$UN)return;if(0===(1024&e.$LI.flags))for(var h=e.$LI.dom;!l(c=c.parentVNode);)(14&c.flags)>0&&(c.dom=h);Je.length>0&&w(Je)}else e.state=e.$PS,e.$PS=null;i(n)&&n.call(e)}}function Ve(){return{text:"New Node",itree:{state:{editing:!0,focused:!0}}}}function Re(t,n){var o=n.dirty||!1;return o||e.each(Object.keys(n),function(e){return"dirty"!==e&&n[e]!==t[e]?(o=!0,!1):void 0}),o}t=t&&t.hasOwnProperty("default")?t["default"]:t;var je="$NO_OP",Be="a runtime error occured! Use Inferno in development environment to find the error.",We=!("undefined"==typeof window||!window.document),He=Array.isArray,qe="$",Ke={afterRender:null,beforeRender:null,createVNode:null,renderComplete:null},Xe="http://www.w3.org/1999/xlink",ze="http://www.w3.org/XML/1998/namespace",Qe="http://www.w3.org/2000/svg",Ge={"xlink:actuate":Xe,"xlink:arcrole":Xe,"xlink:href":Xe,"xlink:role":Xe,"xlink:show":Xe,"xlink:title":Xe,"xlink:type":Xe,"xml:base":ze,"xml:lang":ze,"xml:space":ze},Ye={},Je=[],Ze={},et={},tt=F("onInput",R),nt=F(["onClick","onChange"],R);I.wrapped=!0;var ot=F("onChange",H),rt=F("onInput",K),it=F("onChange"),at=(We?document.body:null,"undefined"==typeof Promise?null:Promise.resolve()),st="undefined"==typeof requestAnimationFrame?setTimeout:requestAnimationFrame.bind(window),lt=function(e,t){this.state=null,this.$BR=!1,this.$BS=!0,this.$PSS=!1,this.$PS=null,this.$LI=null,this.$V=null,this.$UN=!1,this.$CX=null,this.$UPD=!0,this.$QU=null,this.props=e||Ye,this.context=t||Ye};lt.prototype.forceUpdate=function(e){this.$UN||Fe(this,{},e,!0)},lt.prototype.setState=function(e,t){this.$UN||this.$BS||Fe(this,e,t,!1)},lt.prototype.render=function(e,t,n){};var dt=(Object.freeze({}),12),ct=37,ut=38,pt=39,ft=40,ht=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},vt=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),gt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},mt=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},yt=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},bt=function(e){function t(){return ht(this,t),yt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return mt(t,e),vt(t,[{key:"click",value:function(e){var t=this,n=function(){t.props.node.toggleCheck()};this.props.dom._tree.emit("node.click",e,this.props.node,n),e.treeDefaultPrevented||n()}},{key:"render",value:function(){return h(64,"input",null,null,1,{checked:this.props.checked,indeterminate:this.props.indeterminate,onClick:this.click.bind(this),type:"checkbox"})}}]),t}(lt),kt=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"li",o=t.itree[n].attributes,r=[],i=o["class"]||o.className;return e.isFunction(i)&&(i=i(t)),e.isEmpty(i)||(e.isString(i)?r=r.concat(i.split(/[\s\.]+/)):e.isArray(i)&&(r=r.concat(i))),r},$t=function(e){function t(){return ht(this,t),yt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return mt(t,e),vt(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"add",value:function(e){e.stopPropagation(),this.props.node.addChild(Ve()),this.props.node.expand()}},{key:"edit",value:function(e){e.stopPropagation(),this.props.node.toggleEditing()}},{key:"remove",value:function(e){e.stopPropagation(),this.props.node.remove()}},{key:"render",value:function(){var e=[];return this.props.dom._tree.config.editing.edit&&e.push(h(1,"a","btn icon icon-pencil",null,1,{onclick:this.edit.bind(this),title:"Edit this node"})),this.props.dom._tree.config.editing.add&&e.push(h(1,"a","btn icon icon-plus",null,1,{onclick:this.add.bind(this),title:"Add a child node"})),this.props.dom._tree.config.editing.remove&&e.push(h(1,"a","btn icon icon-minus",null,1,{onclick:this.remove.bind(this),title:"Remove this node"})),h(1,"span","btn-group",e,0)}}]),t}(lt),Ct=function(e){function t(){return ht(this,t),yt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return mt(t,e),vt(t,[{key:"render",value:function(){return h(1,"ol",null,h(1,"li","leaf",h(1,"span","title icon icon-file-empty empty",this.props.text,0),2),2)}}]),t}(lt),Dt=function(e){function t(e){ht(this,t);var n=yt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=n.getStateFromNodes(e.node),n}return mt(t,e),vt(t,[{key:"getStateFromNodes",value:function(e){return{text:e.text}}},{key:"componentWillReceiveProps",value:function(e){this.setState(this.getStateFromNodes(e.node))}},{key:"shouldComponentUpdate",value:function(e,t){return Re(this.state,t)}},{key:"click",value:function(e){var t=this,n=function(){t.props.node.toggleCheck()};this.props.dom._tree.emit("node.click",e,this.props.node,n),e.treeDefaultPrevented||n()}},{key:"keypress",value:function(e){return e.which===dt?this.save():void 0}},{key:"input",value:function(e){this.setState({text:e.target.value})}},{key:"cancel",value:function(e){e&&e.stopPropagation(),this.props.node.toggleEditing()}},{key:"save",value:function(e){e&&e.stopPropagation();var t=this.props.node.text,n=this.ref.value;this.props.node.set("text",n),this.props.node.state("editing",!1),this.props.node.markDirty(),this.props.dom._tree.applyChanges(),t!==n&&this.props.dom._tree.emit("node.edited",this.props.node,t,n)}},{key:"render",value:function(){var e=this;return h(1,"form",null,[h(64,"input",null,null,1,{onClick:function(e){return e.stopPropagation},onInput:this.input.bind(this),onKeyPress:this.keypress.bind(this),value:this.state.text},null,function(t){return e.ref=t}),h(1,"span","btn-group",[h(1,"button","btn icon icon-check",null,1,{onClick:this.save.bind(this),title:"Save",type:"button"}),h(1,"button","btn icon icon-cross",null,1,{onClick:this.cancel.bind(this),title:"Cancel",type:"button"})],4)],4,{onsubmit:function(e){return e.preventDefault}})}}]),t}(lt),_t=function(t){function n(){return ht(this,n),yt(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return mt(n,t),vt(n,[{key:"blur",value:function(){this.props.node.blur()}},{key:"click",value:function(e){var t=this,n=this.props,o=n.node,r=n.dom,i=function(){if(e.preventDefault(),!t.props.editing){if((e.metaKey||e.ctrlKey||e.shiftKey)&&r._tree.disableDeselection(),e.shiftKey){r.clearSelection();var n=r._tree.lastSelectedNode();n&&r._tree.selectBetween.apply(r._tree,r._tree.boundingNodes(n,o))}o.selected()?r._tree.config.selection.disableDirectDeselection||o.deselect():o.select(),r._tree.enableDeselection()}};r._tree.emit("node.click",e,o,i),e.treeDefaultPrevented||i()}},{key:"contextMenu",value:function(e){var t=this.props,n=t.node,o=t.dom;o._tree.emit("node.contextmenu",e,n)}},{key:"dblclick",value:function(e){var t=this.props,n=t.node,o=t.dom,r=function(){o.clearSelection(),n.toggleCollapse()};o._tree.emit("node.dblclick",e,n,r),e.treeDefaultPrevented||r()}},{key:"focus",value:function(e){this.props.node.focus(e)}},{key:"mousedown",value:function(){this.props.dom.isDragDropEnabled&&(this.props.dom.isMouseHeld=!0)}},{key:"render",value:function(){var t=this.props.node,n=e.clone(t.itree.a.attributes)||{};n.tabindex=1,n.unselectable="on";var o=kt(t,"a").concat(["title","icon"]),r=this.props.expanded?"icon-folder-open":"icon-folder";o.push(t.itree.icon||(this.props.hasOrWillHaveChildren?r:"icon-file-empty")),n["class"]=n.className=o.join(" ");var i=t.text;return t.editing()&&(i=v(2,Dt,{dom:this.props.dom,node:this.props.node})),m(h(1,"a",null,i,0,gt({"data-uid":t.id,onBlur:this.blur.bind(this),onClick:this.click.bind(this),onContextMenu:this.contextMenu.bind(this),onDblClick:this.dblclick.bind(this),onFocus:this.focus.bind(this),onMouseDown:this.mousedown.bind(this)},n)))}}]),n}(lt),xt=function(e){function t(){return ht(this,t),yt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return mt(t,e),vt(t,[{key:"className",value:function(){return"toggle icon "+(this.props.collapsed?"icon-expand":"icon-collapse")}},{key:"render",value:function(){return h(1,"a",this.className(),null,1,{onClick:this.props.node.toggleCollapse.bind(this.props.node)})}}]),t}(lt),St=function(n){function o(e){ht(this,o);var t=yt(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t.state=t.stateFromNode(e.node),t}return mt(o,n),vt(o,[{key:"stateFromNode",value:function(e){return{dirty:e.itree.dirty}}},{key:"componentWillReceiveProps",value:function(e){this.setState(this.stateFromNode(e.node))}},{key:"shouldComponentUpdate",value:function(e,t){return t.dirty}},{key:"getAttributes",value:function(){var t=this.props.node,n=e.clone(t.itree.li.attributes)||{};return n["class"]=n.className=this.getClassNames(),n["data-uid"]=t.id,this.props.dom.config.dragAndDrop.enabled&&(n.draggable=t.state("draggable"),n.onDragEnd=this.onDragEnd.bind(this),n.onDragEnter=this.onDragEnter.bind(this),n.onDragLeave=this.onDragLeave.bind(this),n.onDragStart=this.onDragStart.bind(this),t.state("drop-target")?(n.onDragOver=this.onDragOver.bind(this),n.onDrop=this.onDrop.bind(this)):(n.onDragOver=null,n.onDrop=null)),n}},{key:"getClassNames",value:function(){var t=this.props.node,n=t.itree.state,o=kt(t);return e.each(Object.keys(n),function(e){n[e]&&o.push(e)}),!t.hidden()&&t.removed()&&o.push("hidden"),t.expanded()&&o.push("expanded"),o.push(t.hasOrWillHaveChildren()?"folder":"leaf"),o.join(" ")}},{key:"getTargetDirection",value:function(e,t){var n=e.clientY,o=t.getBoundingClientRect(),r=o.top+o.height/3,i=o.bottom-o.height/3,a=0;return r>=n?a=-1:n>=i&&(a=1),a}},{key:"onDragStart",value:function(n){n.stopPropagation(),n.dataTransfer.effectAllowed="move",n.dataTransfer.dropEffect="move";var o=this.props.node;if(this.props.dom._activeDragNode=o,n.dataTransfer.setData("treeId",o.tree().id),n.dataTransfer.setData("nodeId",o.id),o.state("drop-target",!1),o.hasChildren()&&o.children.stateDeep("drop-target",!1),"dragstart"===this.props.dom.config.dragAndDrop.validateOn){var r=this.props.dom.config.dragAndDrop.validate,i=e.isFunction(r),a=function s(n,o){t.isTreeNodes(n)?e.each(n,function(e){s(e,o)}):t.isTreeNode(n)&&o(n)!==!1&&n.hasChildren()&&s(n.children,o)};this.props.dom._tree.batch(),a(this.props.dom._tree.model,function(e){var t=e.id!==o.id;return t&&(t=!e.hasAncestor(o)),t&&i&&(t=r(o,e)),e.state("drop-target",t),t}),this.props.dom._tree.end()}this.props.dom._tree.emit("node.dragstart",n)}},{key:"onDragEnd",value:function(e){e.preventDefault(),e.stopPropagation(),this.unhighlightTarget(),this.props.dom._tree.emit("node.dragend",e)}},{key:"onDragEnter",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.node.recurseUp(this.unhighlightTarget),this.props.node.state("drag-targeting",!0),this.props.dom._tree.emit("node.dragenter",e)}},{key:"onDragLeave",value:function(e){e.preventDefault(),e.stopPropagation(),this.unhighlightTarget(),this.props.dom._tree.emit("node.dragleave",e)}},{key:"onDragOver",value:function(t){t.preventDefault(),t.stopPropagation();var n=this.props.dom._activeDragNode,o=this.props.node,r=this.getTargetDirection(t,o.itree.ref.querySelector("a"));if("dragover"===this.props.dom.config.dragAndDrop.validateOn){var i=this.props.dom.config.dragAndDrop.validate,a=e.isFunction(i),s=n.id!==o.id;if(s&&(s=!o.hasAncestor(n)),s&&a&&(s=i(n,o,r)),o.state("drop-target",s),this.props.dom._tree.applyChanges(),!s)return}this.props.dom._tree.batch(),o.state("drag-targeting",!0),o.state("drag-targeting-above",-1===r),o.state("drag-targeting-below",1===r),o.state("drag-targeting-insert",0===r),this.props.dom._tree.end(),this.props.dom._tree.emit("node.dragover",t,r)}},{key:"onDrop",value:function(e){e.preventDefault(),e.stopPropagation(),this.unhighlightTarget();var t=e.dataTransfer.getData("treeId"),n=e.dataTransfer.getData("nodeId"),o=this.props.node;this.props.dom._activeDragNode=null;var r=this.getTargetDirection(e,e.target),i=void 0;t===this.props.dom._tree.id?i=this.props.dom._tree:t&&(i=document.querySelector('[data-uid="'+t+'"]').inspireTree);var a=void 0,s=void 0;if(i){var l=i.node(n);l.state("drop-target",!0);var d=l.remove(!0),c=o.context().indexOf(o);0===r?(a=o.addChild(d),s=o.children.indexOf(a),o.expand()):(s=1===r?++c:c,a=o.context().insertAt(s,d))}this.props.dom._tree.emit("node.drop",e,a,o,s)}},{key:"unhighlightTarget",value:function(e){(e||this.props.node).states(["drag-targeting","drag-targeting-above","drag-targeting-below","drag-targeting-insert"],!1)}},{key:"renderCheckbox",value:function(){var e=this.props.node;return this.props.dom.config.showCheckboxes?v(2,bt,{checked:e.checked(),dom:this.props.dom,indeterminate:e.indeterminate(),node:e}):void 0}},{key:"renderChildren",value:function(){var e=this.props,t=e.node,n=e.dom;if(t.hasChildren()){var o=t.children,r=n.loading,i=o.pagination();return v(2,wt,{context:t,dom:n,limit:i.limit,loading:r,nodes:o,total:i.total})}return this.props.dom.isDynamic&&t.children?t.hasLoadedChildren()?v(2,Ct,{text:"No Results"}):v(2,Ct,{text:"Loading..."}):void 0}},{key:"renderEditToolbar",value:function(){return this.props.dom._tree.config.editing.edit&&!this.props.node.editing()?v(2,$t,{dom:this.props.dom,node:this.props.node}):void 0}},{key:"renderToggle",value:function(){var e=this.props.node,t=this.props.dom.isDynamic?Boolean(e.children):e.hasVisibleChildren();
return t?v(2,xt,{collapsed:e.collapsed(),node:e}):void 0}},{key:"render",value:function(){var e=this,t=this.props.node,n=m(h(1,"li",null,[this.renderEditToolbar(),h(1,"div","title-wrap",[this.renderToggle(),this.renderCheckbox(),v(2,_t,{dom:this.props.dom,editing:t.editing(),expanded:t.expanded(),hasOrWillHaveChildren:t.hasOrWillHaveChildren(),node:t,text:t.text})],0),h(1,"div","wholerow"),this.renderChildren()],0,gt({},this.getAttributes()),null,function(t){return e.node=e.props.node.itree.ref=t}));return this.props.node.state("rendered",!0),this.props.node.itree.dirty=!1,n}}]),o}(lt),wt=function(t){function n(){return ht(this,n),yt(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return mt(n,t),vt(n,[{key:"shouldComponentUpdate",value:function(t){return e.find(t.nodes,"itree.dirty")||Re(this.props,t)}},{key:"isDeferred",value:function(){return this.props.dom.config.deferredRendering||this.props.dom._tree.config.deferredLoading}},{key:"loadMore",value:function(e){e.preventDefault(),this.props.context?this.props.context.loadMore(e):this.props.dom._tree.loadMore(e)}},{key:"renderLoadMoreNode",value:function(){return h(1,"li","leaf detached",h(1,"a","title icon icon-more load-more",g("Load More"),2,{onClick:this.loadMore.bind(this)}),2)}},{key:"renderLoadingTextNode",value:function(){return h(1,"li","leaf",h(1,"span","title icon icon-more",g("Loading..."),2),2)}},{key:"render",value:function(){var t=this,n=this.props.nodes,o=n.pagination();if(this.props.dom.config.deferredRendering){var r=0;n=this.props.nodes.filter(function(e){var t=!(e.hidden()||e.removed());return t&&r++,r<=o.limit&&t})}var i=e.map(n,function(e){return v(2,St,{dom:t.props.dom,node:e},e.id)});return this.isDeferred()&&o.limit<o.total&&(this.props.loading?i.push(this.renderLoadingTextNode()):i.push(this.renderLoadMoreNode())),h(1,"ol",null,[i,this.props.children],0)}}]),n}(lt),Nt=function(e){function t(){return ht(this,t),yt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return mt(t,e),vt(t,[{key:"add",value:function(){this.props.dom._tree.focused().blur(),this.props.dom._tree.addNode(Ve())}},{key:"renderAddLink",value:function(){return this.props.dom._tree.config.editing.add?h(1,"li",null,h(1,"a","btn icon icon-plus",null,1,{onClick:this.add.bind(this),title:"Add a new root node"}),2):void 0}},{key:"render",value:function(){var e=this.props,t=e.dom,n=e.nodes,o=t.loading,r=n.pagination();return v(2,wt,{dom:t,limit:r.limit,loading:o,nodes:n,total:r.total,children:this.renderAddLink()})}}]),t}(lt),Pt=function(){function t(n,o){var r=this;if(ht(this,t),this._tree=n,this.batching=0,this.dropTargets=[],this.$scrollLayer,!o.target)throw new TypeError("Invalid `target` property - must be a selector, HTMLElement, or jQuery element.");n.usesNativeDOM=!0;var i={enabled:!1,validateOn:"dragstart",validate:null};this.config=e.defaultsDeep({},o,{autoLoadMore:!0,deferredRendering:!1,dragAndDrop:i,nodeHeight:25,showCheckboxes:!1,tabindex:-1,target:!1}),o.dragAndDrop===!0&&(this.config.dragAndDrop=i,this.config.dragAndDrop.enabled=!0),this.isDynamic=e.isFunction(this._tree.config.data),this.attach(this.config.target);var a=!0;n.on("changes.applied",function(){r.renderNodes(),a&&(r.scrollSelectedIntoView(),a=!1)}),this.renderNodes()}return vt(t,[{key:"attach",value:function(t){if(this.$target=this.getElement(t),this.$scrollLayer=this.getScrollableAncestor(this.$target),!this.$target)throw new Error("No valid element to attach to.");this.$target.setAttribute("data-uid",this._tree.id);var n=this.$target.className.split(" ");if(n.push("inspire-tree"),this._tree.config.editable&&(n.push("editable"),e.each(e.pickBy(this._tree.config.editing,e.identity),function(e,t){n.push("editable-"+t)})),this.$target.className=n.join(" "),this.$target.setAttribute("tabindex",this.config.tabindex||0),this.$target.addEventListener("keydown",this.keyboardListener.bind(this)),this.config.dragAndDrop.enabled&&(this.$target.addEventListener("dragenter",this.onDragEnter.bind(this),!1),this.$target.addEventListener("dragleave",this.onDragLeave.bind(this),!1),this.$target.addEventListener("dragover",this.onDragOver.bind(this),!1),this.$target.addEventListener("drop",this.onDrop.bind(this),!1),this.$target.classList.add("drag-and-drop")),this._tree.on("node.focused",function(e){var t=e.itree.ref.querySelector(".title");t!==document.activeElement&&t.focus()}),this.config.deferredRendering||this._tree.config.deferredLoading){var o=this._tree.config.pagination.limit;this._tree.config.pagination.limit=o>0?o:e.ceil(this.$scrollLayer.clientHeight/this.config.nodeHeight),this.config.autoLoadMore&&this.$target.addEventListener("scroll",e.throttle(this.scrollListener.bind(this),20))}this.$target.inspireTree=this._tree}},{key:"clearSelection",value:function(){document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}},{key:"getElement",value:function(t){var n=void 0;if(t instanceof HTMLElement)n=t;else if(e.isObject(t)&&e.isObject(t[0]))n=t[0];else if(e.isString(t)){var o=document.querySelector(t);o&&(n=o)}return n}},{key:"getScrollableAncestor",value:function(e){if(e instanceof Element){var t=getComputedStyle(e);"auto"!==t.overflow&&e.parentNode&&(e=this.getScrollableAncestor(e.parentNode))}return e}},{key:"keyboardListener",value:function(e){if(e.stopPropagation(),!([ft,dt,ct,pt,ut].indexOf(e.which)<0)){var t=this._tree.focused();if(t.length)switch(e.preventDefault(),e.which){case ft:this.moveFocusDownFrom(t[0]);break;case dt:t[0].toggleSelect();break;case ct:t[0].collapse();break;case pt:t[0].expand();break;case ut:this.moveFocusUpFrom(t[0])}}}},{key:"moveFocusDownFrom",value:function(e){var t=e.nextVisibleNode();t&&t.focus()}},{key:"moveFocusUpFrom",value:function(e){var t=e.previousVisibleNode();t&&t.focus()}},{key:"nodeFromTitleDOMElement",value:function(e){var t=e.parentNode.parentNode.getAttribute("data-uid");return this._tree.node(t)}},{key:"onDragEnter",value:function(e){e.preventDefault(),e.target.classList.add("drag-targeting","drag-targeting-insert")}},{key:"onDragLeave",value:function(e){e.preventDefault(),this.unhighlightTarget(e.target)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){e.preventDefault(),this.unhighlightTarget(e.target);var n=e.dataTransfer.getData("treeId"),o=e.dataTransfer.getData("nodeId"),r=t.getTreeById(n),i=r.node(o);i.state("drop-target",!0);var a=i.remove(!0),s=this._tree.addNode(a),l=this._tree.indexOf(s);this._tree.emit("node.drop",e,s,null,l)}},{key:"renderNodes",value:function(e){Me(v(2,Nt,{dom:this,nodes:e||this._tree.nodes()}),this.$target)}},{key:"scrollListener",value:function(t){var n=this;if(!this.rendering&&!this.loading){var o=this.$scrollLayer.getBoundingClientRect(),r=document.querySelectorAll(".load-more");e.each(r,function(e){var r=e.getBoundingClientRect(),i=!(o.right<r.left||o.left>r.right||o.bottom<r.top||o.top>r.bottom);if(i){var a=void 0,s=e.parentNode.parentNode.parentNode;"LI"===s.tagName&&(a=n._tree.node(s.getAttribute("data-uid"))),n._tree.loadMore(a,t)}})}}},{key:"scrollSelectedIntoView",value:function(){var e=this.$target.querySelector(".selected");e&&this.$scrollLayer&&(this.$scrollLayer.scrollTop=e.offsetTop)}},{key:"unhighlightTarget",value:function(e){e&&e.classList.remove("drag-targeting","drag-targeting-insert")}}],[{key:"getTreeById",value:function(e){var t=document.querySelector('[data-uid="'+e+'"]');return t?t.inspireTree:void 0}}]),t}();return Pt});